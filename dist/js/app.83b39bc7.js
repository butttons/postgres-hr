(function(e){function t(t){for(var r,s,o=t[0],i=t[1],l=t[2],f=0,d=[];f<o.length;f++)s=o[f],Object.prototype.hasOwnProperty.call(a,s)&&a[s]&&d.push(a[s][0]),a[s]=0;for(r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r]);u&&u(t);while(d.length)d.shift()();return c.push.apply(c,l||[]),n()}function n(){for(var e,t=0;t<c.length;t++){for(var n=c[t],r=!0,o=1;o<n.length;o++){var i=n[o];0!==a[i]&&(r=!1)}r&&(c.splice(t--,1),e=s(s.s=n[0]))}return e}var r={},a={app:0},c=[];function s(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=r,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)s.d(n,r,function(t){return e[t]}.bind(null,r));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],i=o.push.bind(o);o.push=t,o=o.slice();for(var l=0;l<o.length;l++)t(o[l]);var u=i;c.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("cd49")},"0089":function(e,t,n){},"034f":function(e,t,n){"use strict";var r=n("64a9"),a=n.n(r);a.a},"297b":function(e,t,n){},"5aea":function(e,t,n){},"64a9":function(e,t,n){},cd49:function(e,t,n){"use strict";n.r(t);n("cadf"),n("551c"),n("f751"),n("097d");var r,a,c=n("2b0e"),s=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"bg-primary-100 pb-2 font-body",attrs:{id:"app"}},[n("nav-bar",{on:{"show-query-log":function(t){e.app.showQueryLog=!0},"add-connection":function(t){e.app.showAddConnection=!0}}}),n("main",[n("transition",{attrs:{"enter-active-class":"animated slideInRight fast","leave-active-class":"animated slideOutRight faster"}},[e.app.showQueryLog?n("div",{staticClass:"query-log h-screen bg-primary-700 fixed top-0 right-0 w-1/2"},[n("div",{staticClass:"flex justify-between items-center text-white"},[n("div",{staticClass:"text-lg cursor-pointer p-2",on:{click:function(t){e.app.showQueryLog=!1}}},[n("fa-icon",{staticClass:"mr-1",attrs:{icon:"caret-right"}}),e._v("Query Log")],1),n("fa-icon",{staticClass:"mr-2",attrs:{icon:"sync"}})],1),n("div",{staticClass:"p-2 h-full"},[n("pre",{staticClass:"bg-white rounded p-1 h-full"},[n("div",{staticClass:"text-xs"},[n("span",{staticClass:"text-red-500"},[e._v("Notice: ")]),n("span",[e._v("Works")])])])])]):e._e()]),e.app.showAddConnection?n("z-card",{staticClass:"mx-auto w-1/2",attrs:{"has-collapse":!1,"has-close":"",title:"Add new connection"},on:{"close-card":function(t){e.app.showAddConnection=!1}}},[n("z-form-connection")],1):e._e(),n("z-card",{attrs:{title:"Select Roles"}},[n("div",{staticClass:"p-2"},e._l(e.roleList,(function(t,r){return n("z-checkbox",{key:r,staticClass:"mr-1 mb-1",attrs:{label:t,selected:e.selectedRoles},on:{selected:function(t){return e.toggleArray(e.selectedRoles,t)}}})})),1)]),n("z-card",{attrs:{title:"Select Schemas"}},[n("div",{staticClass:"p-2"},e._l(e.schemaList,(function(t,r){return n("z-checkbox",{key:r,staticClass:"mr-1 mb-1",attrs:{label:t,selected:e.selectedSchemas},on:{selected:function(t){return e.toggleArray(e.selectedSchemas,t)}}})})),1)]),n("z-card",{ref:"manageCard",attrs:{title:"Manage"}},[n("div",{staticClass:"px-2"},[e._l(e.config.manage,(function(t,r){return n("z-checkbox",{key:r,staticClass:"mr-2",attrs:{label:t.label,selected:e.selectedEntities},on:{selected:function(t){return e.toggleArray(e.selectedEntities,t)}}})})),e.hasSelected?n("div",{staticClass:"mt-2"},[n("div",{class:e.headerClass},[n("z-manage-row",{attrs:{title:"Roles","is-sticky":e.app.showStickyHeader,type:"header"}},e._l(e.selectedRoles,(function(t,r){return n("div",{key:r},[e._v(e._s(t))])})),0)],1),n("draggable",[n("transition-group",e._l(e.filteredEntities,(function(t,r){return n("z-manage-row",{key:t.label,attrs:{title:t.label,level:t.level,type:t.type,meta:t.meta}},e._l(t.grants,(function(r,a){return n("z-entity-grant",{key:a,attrs:{type:t.type,grants:r,entity:t,role:a,meta:t.meta},on:{"run-query":e.runQuery}})})),1)})),1)],1)],1):e._e()],2)])],1)],1)},o=[],i=(n("8e6e"),n("ac6a"),n("456d"),n("6762"),n("2fdb"),n("bd86")),l=n("310e"),u=n.n(l),f=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("nav",{staticClass:"flex justify-between items-center bg-primary-500",attrs:{role:"navigation","aria-label":"main navigation"}},[e._m(0),n("div",{staticClass:"mr-3 flex items-center"},[n("div",{staticClass:"mr-2 flex"},[n("select",{directives:[{name:"model",rawName:"v-model",value:e.selectedConnection,expression:"selectedConnection"}],staticClass:"input--full",on:{change:[function(t){var n=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.selectedConnection=t.target.multiple?n:n[0]},e.handleConnectionChange]}},e._l(e.clientList,(function(t,r){return n("option",{key:r,domProps:{value:t[0]}},[e._v(e._s(e._f("clientName")(t[1])))])})),0),n("button",{directives:[{name:"tooltip",rawName:"v-tooltip",value:"Add new connection",expression:'"Add new connection"'}],staticClass:"button__nav--icon ml-1",on:{click:function(t){return e.$emit("add-connection")}}},[n("fa-icon",{staticClass:"mr-1",attrs:{icon:"plus"}})],1)]),n("z-checkbox",{staticClass:"mr-2",attrs:{label:"Ignore PG",selected:e.ignorePg},on:{selected:function(t){return e.toggleArray(e.ignorePg,t)}}}),n("button",{directives:[{name:"tooltip",rawName:"v-tooltip",value:"Show queries",expression:'"Show queries"'}],staticClass:"button__nav--icon",on:{click:function(t){return e.$emit("show-query-log")}}},[n("fa-icon",{attrs:{icon:"bolt"}})],1)],1)])},d=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"text-lg text-white p-3 font-display"},[e._v("Postgres"),n("strong",[e._v("HR")])])}],p=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("fieldset",{staticClass:"border rounded border-gray-300 bg-gray-200 focus-within:bg-white focus-within:border-primary-400"},[n("legend",{staticClass:"text-sm text-gray-700"},[e._v(e._s(e.label)+" ")]),e._t("default")],2)},h=[],E=c["a"].extend({name:"v-fieldset",props:{label:String}}),m=E,g=n("2877"),b=Object(g["a"])(m,p,h,!1,null,null,null),C=b.exports,v=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"checkbox items-center p-2 inline-flex rounded pointer select-none cursor-pointer",class:e.wrapColors,on:{click:function(t){return e.$emit("selected",e.label)}}},[n("fa-icon",{staticClass:"mr-1",attrs:{icon:e.iconFont}}),n("div",{staticClass:"text-sm"},[e._v(e._s(e.label))])],1)},_=[],O=c["a"].extend({name:"z-checkbox",props:{label:String,selected:Array},computed:{isSelected:function(){return this.selected.includes(this.label)},wrapColors:function(){return{"bg-gray-300 text-gray-700 hover:bg-gray-400":!this.isSelected,"bg-green-300 text-green-700 hover:bg-green-400":this.isSelected}},iconFont:function(){return this.isSelected?["fas","check-circle"]:["far","circle"]}}}),T=O,y=(n("f7aa"),Object(g["a"])(T,v,_,!1,null,"eab987ae",null)),S=y.exports,N=(n("20d6"),function(e,t){if(e.includes(t)){var n=e.findIndex((function(e){return e===t}));e.splice(n,1)}else e.push(t)}),w={methods:{toggleArray:N}};(function(e){e["SET_INFO"]="SET_INFO",e["SET_GRANTS"]="SET_GRANTS",e["SET_SCHEMAS"]="SET_SCHEMAS",e["SET_ROLES"]="SET_ROLES",e["SELECT_SCHEMAS"]="SELECT_SCHEMAS",e["SELECT_ROLES"]="SELECT_ROLES",e["RESET_SELECTED"]="RESET_SELECTED",e["SET_CONFIG_IGNORE"]="SET_CONFIG_IGNORE",e["SET_CACHE_STATUS"]="SET_CACHE_STATUS",e["SET_CACHE_CONNECTION"]="SET_CACHE_CONNECTION",e["SET_CACHE_CONNECTION_LIST"]="SET_CACHE_CONNECTION_LIST",e["REFRESH_TABLE"]="REFRESH_TABLE"})(a||(a={}));var R,j,A,x=(r={},Object(i["a"])(r,a.REFRESH_TABLE,(function(e){e.refreshTable=!0,e.refreshTable=!1})),Object(i["a"])(r,a.SET_INFO,(function(e,t){return e.info=t})),Object(i["a"])(r,a.SET_GRANTS,(function(e,t){return e.grants=t})),Object(i["a"])(r,a.SET_SCHEMAS,(function(e,t){return e.init.schemas=t})),Object(i["a"])(r,a.SET_ROLES,(function(e,t){return e.init.roles=t})),Object(i["a"])(r,a.SELECT_SCHEMAS,(function(e,t){return e.selected.schemas=t})),Object(i["a"])(r,a.SELECT_ROLES,(function(e,t){return e.selected.roles=t})),Object(i["a"])(r,a.RESET_SELECTED,(function(e){return e.selected.roles=[],e.selected.schemas=[],e})),Object(i["a"])(r,a.SET_CONFIG_IGNORE,(function(e,t){return e.config.ignorePg=t})),Object(i["a"])(r,a.SET_CACHE_STATUS,(function(e,t){return e.config.cache.hasCached=t})),Object(i["a"])(r,a.SET_CACHE_CONNECTION,(function(e,t){return e.config.cache.currentConnection=t})),Object(i["a"])(r,a.SET_CACHE_CONNECTION_LIST,(function(e,t){return e.config.cache.connectionList=t})),r),I=n("2f62"),L=n("75fc"),G=n("768b");n("ac4d"),n("8a81"),n("4f7f"),n("ffc1"),n("4917"),n("28a5"),n("f559"),n("5df3"),n("f400");function P(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function k(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?P(n,!0).forEach((function(t){Object(i["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):P(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}(function(e){e["CONNECTION_LIST"]="clientList",e["SCHEMA_LIST"]="schemaList",e["ROLE_LIST"]="roleList",e["TABLE_COLUMN_MAP"]="tableColumnMap",e["TABLE_SET"]="tableSet",e["ROUTINE_SET"]="routineSet",e["ENTITY_TREE"]="entityTree",e["GRANT_COLUMN_MAP"]="grantColumn",e["GRANT_TABLE_MAP"]="grantTable",e["GRANT_ROUTINE_MAP"]="grantRoutine",e["GRANT_OBJECT_MAP"]="grantObject",e["TRIGGER_MAP"]="triggerMap"})(j||(j={})),function(e){e["TABLE"]="table",e["COLUMN"]="column",e["ROUTINE"]="routine",e["OBJECT"]="object",e["TRIGGER"]="trigger"}(A||(A={}));var M,U,H=function(e){return"".concat(e.table_schema,".").concat(e.table_name,".").concat(e.column_name)},F=function(e){return"".concat(e.table_schema,".").concat(e.table_name)},B=function(e){return"".concat(e.routine_schema,".").concat(e.routine_name)},D=function(e){return"".concat(e.object_schema,".").concat(e.object_name)},$=function(e){return"".concat(e.trigger_schema,".").concat(e.event_object_table)},q=function(e){return"".concat(e.table_name,".").concat(e.column_name)},z=F,Q=function(e,t,n){var r=new Map;return e.forEach((function(e){var a=n(e);r.has(a)||r.set(a,{});var c=e.grantee,s=r.get(a);t.forEach((function(e){e in s||(s[e]=[])})),c in s||(s[c]=[]),s[c].push(e.privilege_type)})),r},J=function(e){var t=new Map;return e.forEach((function(e){var n=F(e),r=H(e);t.has(n)||t.set(n,{label:z(e),columns:new Map});var a=t.get(n);a.columns.set(r,{label:q(e),columnName:e.column_name})})),t},Z=function(e,t){return t?e.filter((function(e){return!e.startsWith("pg_")})):e},Y=function(e){return e.reduce((function(e,t){return e[t]=[],e}),{})},W=function(e){var t=e.split(".");return t.length>1?e:"public.".concat(e)},X=function(e){var t=/EXECUTE (PROCEDURE|FUNCTION) ([\w\.]+)\(/;if(!t.test(e))return null;var n=e.match(t)[2];return W(n)},K=function(e){var t=X(e.action_statement),n=e.action_timing,r=e.trigger_name,a=e.trigger_schema,c=e.event_manipulation,s=e.event_object_schema,o=e.event_object_table;return{label:"".concat(a,".").concat(r),functionTarget:t,tableTarget:"".concat(s,".").concat(o),meta:{actionTiming:n,eventManipulation:c}}},V=function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,c=new Map([[A.TABLE,0],[A.COLUMN,1],[A.ROUTINE,2],[A.TRIGGER,1],[A.OBJECT,1]]);return{type:e,label:t,grants:n,meta:r,level:null===a?c.get(e):a}},ee=(R={},Object(i["a"])(R,j.CONNECTION_LIST,(function(e){var t=e.config.cache.connectionList;return t?Object.entries(t):null})),Object(i["a"])(R,j.SCHEMA_LIST,(function(e){return Z(e.init.schemas,e.config.ignorePg)})),Object(i["a"])(R,j.ROLE_LIST,(function(e){return Z(e.init.roles,e.config.ignorePg)})),Object(i["a"])(R,j.GRANT_COLUMN_MAP,(function(e){return Q(e.grants.columns,e.selected.roles,H)})),Object(i["a"])(R,j.GRANT_TABLE_MAP,(function(e){return Q(e.grants.tables,e.selected.roles,F)})),Object(i["a"])(R,j.GRANT_ROUTINE_MAP,(function(e){return Q(e.grants.routines,e.selected.roles,B)})),Object(i["a"])(R,j.GRANT_OBJECT_MAP,(function(e){return Q(e.grants.objects,e.selected.roles,D)})),Object(i["a"])(R,j.TABLE_COLUMN_MAP,(function(e){return J(e.info.columns)})),Object(i["a"])(R,j.TABLE_SET,(function(e){return new Set(e.info.tables.map(F))})),Object(i["a"])(R,j.ROUTINE_SET,(function(e){return new Set(e.info.routines.map(B))})),Object(i["a"])(R,j.ENTITY_TREE,(function(e,t){console.log("recalc");var n=Y(e.selected.roles),r=e.info.tables.length>0,a=e.info.columns.length>0,c=e.selected.roles.length>0;if(!a||!r||!c)return[];var s=[],o=t[j.GRANT_TABLE_MAP],i=t[j.GRANT_COLUMN_MAP],l=t[j.GRANT_ROUTINE_MAP],u=t[j.TRIGGER_MAP],f=!0,d=!1,p=void 0;try{for(var h,E=t[j.ROUTINE_SET][Symbol.iterator]();!(f=(h=E.next()).done);f=!0){var m=h.value,g=l.has(m);if(g){var b=l.get(m);s.push(V(A.ROUTINE,m,b))}else s.push(V(A.ROUTINE,m,n))}}catch(ae){d=!0,p=ae}finally{try{f||null==E.return||E.return()}finally{if(d)throw p}}var C=!0,v=!1,_=void 0;try{for(var O,T=t[j.TABLE_COLUMN_MAP][Symbol.iterator]();!(C=(O=T.next()).done);C=!0){var y=Object(G["a"])(O.value,2),S=y[0],N=y[1],w=o.has(S);if(w){var R=o.get(S);s.push(V(A.TABLE,S,R,{sql:"{:action} {:grant} ON TABLE ".concat(S)}))}else s.push(V(A.TABLE,N.label,n,{sql:"{:action} {:grant} ON TABLE ".concat(N.label)}));var x=u.has(S);if(x){var I=u.get(S),L=!0,P=!1,M=void 0;try{for(var U,H=I[Symbol.iterator]();!(L=(U=H.next()).done);L=!0){var F=U.value,B=F.label,D=F.functionTarget,$=F.meta;if(s.push(V(A.TRIGGER,B,n,k({},$,{sql:"{:action} {:grant} ON SEQUENCE ".concat(B)}))),null!==D){var q=l.has(D);if(q){var z=l.get(D);s.push(V(A.ROUTINE,D,z,{sql:"{:action} {:grant} ON FUNCTION ".concat(D)}))}else s.push(V(A.ROUTINE,D,n,{sql:"{:action} {:grant} ON FUNCTION ".concat(D)}))}}}catch(ae){P=!0,M=ae}finally{try{L||null==H.return||H.return()}finally{if(P)throw M}}}var Q=!0,J=!1,Z=void 0;try{for(var W,X=N.columns[Symbol.iterator]();!(Q=(W=X.next()).done);Q=!0){var K=Object(G["a"])(W.value,2),ee=K[0],te=K[1],ne=i.has(ee);if(ne){var re=i.get(ee);s.push(V(A.COLUMN,te.label,re,{sql:"{:action} {:grant} (".concat(te.columnName,") ON TABLE ").concat(N.label)}))}else s.push(V(A.COLUMN,te.label,n,{sql:"{:action} {:grant} (".concat(te.columnName,") ON TABLE ").concat(N.label)}))}}catch(ae){J=!0,Z=ae}finally{try{Q||null==X.return||X.return()}finally{if(J)throw Z}}}}catch(ae){v=!0,_=ae}finally{try{C||null==T.return||T.return()}finally{if(v)throw _}}return s})),Object(i["a"])(R,j.TRIGGER_MAP,(function(e){var t=new Map;return e.info.triggers.forEach((function(e){var n=$(e),r=K(e);t.has(n)?t.set(n,[].concat(Object(L["a"])(t.get(n)),[r])):t.set(n,[r])})),t})),R),te=(n("96cf"),n("3b8d")),ne="http://localhost:4000/api",re=function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(t,n){var r,a,c,s,o=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=o.length>2&&void 0!==o[2]?o[2]:"POST",a="POST"===r,c=a?{"Content-Type":"application/json"}:{},s=a?JSON.stringify(n):null,e.next=6,fetch("".concat(ne).concat(t),{method:r,headers:c,body:s}).then((function(e){return e.json()}));case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();(function(e){e["INIT"]="init",e["FETCH_DATA"]="fetchData",e["GET_INFO"]="getInfo",e["GET_GRANTS"]="getGrants",e["GET_CACHED_CONNECTIONS"]="getCachedClients",e["GET_CURRENT_CONNECTION"]="getCurrentConnection",e["NEW_CONNECTION"]="newConnection",e["SET_CONNECTION"]="setConnection",e["RUN_QUERY"]="runQuery",e["REFRESH_DATA"]="refreshData"})(U||(U={}));var ae=(M={},Object(i["a"])(M,U.INIT,function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:n=t.dispatch,n(U.GET_CURRENT_CONNECTION),n(U.GET_CACHED_CONNECTIONS),n(U.FETCH_DATA);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Object(i["a"])(M,U.GET_CURRENT_CONNECTION,function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=t.commit,e.next=3,re("/cache/current",null,"GET");case 3:r=e.sent,"notCached"in r?(n(a.SET_CACHE_STATUS,!1),n(a.SET_CACHE_CONNECTION,null)):(n(a.SET_CACHE_STATUS,!0),n(a.SET_CACHE_CONNECTION,r.currentId));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Object(i["a"])(M,U.FETCH_DATA,function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(t){var n,r,c,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=t.commit,e.next=3,re("/info/init",null,"GET");case 3:r=e.sent,c=r.schemas,s=r.roles,n(a.SET_SCHEMAS,c),n(a.SET_ROLES,s);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Object(i["a"])(M,U.GET_INFO,function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(t,n){var r,c,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=t.commit,c=n.schemas,r(a.SELECT_SCHEMAS,c),e.next=5,re("/info",{schemas:c});case 5:s=e.sent,r(a.SET_INFO,s);case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),Object(i["a"])(M,U.GET_GRANTS,function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(t,n){var r,c,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=t.commit,c=n.grantees,r(a.SELECT_ROLES,c),e.next=5,re("/grants",{grantees:c});case 5:s=e.sent,r(a.SET_GRANTS,s);case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),Object(i["a"])(M,U.GET_CACHED_CONNECTIONS,function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=t.commit,e.next=3,re("/cache/connections",null,"GET");case 3:r=e.sent,n(a.SET_CACHE_CONNECTION_LIST,r);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Object(i["a"])(M,U.NEW_CONNECTION,function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(t,n){var r,c,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=t.commit,c=n.connection,e.next=4,re("/cache/newConnection",{connection:c});case 4:s=e.sent,r(a.SET_CACHE_CONNECTION_LIST,s);case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),Object(i["a"])(M,U.SET_CONNECTION,function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(t,n){var r,c,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=t.commit,c=t.dispatch,s=n.connectionId,e.next=4,re("/cache/setConnection",{connectionId:s});case 4:r(a.RESET_SELECTED),r(a.SET_CACHE_CONNECTION,s),c(U.FETCH_DATA);case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),Object(i["a"])(M,U.REFRESH_DATA,function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(t,n){var r,a,c;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=t.dispatch,a=n.schemas,c=n.grantees,e.next=4,r(U.GET_INFO,{schemas:a});case 4:return e.next=6,r(U.GET_GRANTS,{grantees:c});case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),Object(i["a"])(M,U.RUN_QUERY,function(){var e=Object(te["a"])(regeneratorRuntime.mark((function e(t,n){var r,a,c,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=t.dispatch,a=n.sql,c=n.schemas,s=n.grantees,e.next=4,re("/info/query",{sql:a});case 4:r(U.REFRESH_DATA,{schemas:c,grantees:s});case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),M);function ce(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function se(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ce(n,!0).forEach((function(t){Object(i["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ce(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var oe=c["a"].extend({name:"nav-bar",mixins:[w],data:function(){return{ignorePg:[],selectedConnection:""}},filters:{clientName:function(e){return"".concat(e.user,"@").concat(e.host,":").concat(e.port||5422,"/").concat(e.database)}},mounted:function(){this.$store.state.config.ignorePg&&(this.ignorePg=["Ignore PG"]),this.$store.state.config.cache.currentConnection&&(this.selectedConnection=this.$store.state.config.cache.currentConnection)},computed:se({},Object(I["c"])({currentConnection:function(e){return e.config.cache.currentConnection}}),{},Object(I["b"])([j.CONNECTION_LIST])),watch:{ignorePg:function(e,t){var n=e.length>0;this.$store.commit(a.SET_CONFIG_IGNORE,n)}},methods:{handleConnectionChange:function(){this.$store.dispatch(U.SET_CONNECTION,{connectionId:this.selectedConnection})}},components:{ZCheckbox:S,ZFieldset:C}}),ie=oe,le=Object(g["a"])(ie,f,d,!1,null,null,null),ue=le.exports,fe=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"bg-white m-3 rounded-lg"},[n("div",{staticClass:"font-display flex items-center justify-between p-2"},[n("div",{class:e.titleClass,on:{click:e.showBody}},[e._v(e._s(e.title))]),n("div",[e.hasCollapse?n("fa-icon",{staticClass:"text-gray-400 cursor-pointer hover:text-gray-600",attrs:{icon:e.fontName},on:{click:e.handleCollapse}}):e._e(),e.hasClose?n("fa-icon",{staticClass:"text-gray-400 cursor-pointer hover:text-gray-600",attrs:{icon:"times-circle"},on:{click:function(t){return e.$emit("close-card")}}}):e._e()],1)]),e.isCollapsed?e._e():n("div",{staticClass:"font-body"},[e._t("default"),e._t("action")],2)])},de=[],pe=c["a"].extend({name:"z-card",props:{title:String,collapsed:{type:Boolean,default:!1},hasCollapse:{type:Boolean,default:!0},hasClose:{type:Boolean,default:!1}},mounted:function(){this.isCollapsed=this.collapsed},data:function(){return{isCollapsed:!1}},computed:{fontName:function(){return this.isCollapsed?"plus-circle":"minus-circle"},titleClass:function(){return{"text-gray-800":!this.isCollapsed,"text-gray-600 cursor-pointer":this.isCollapsed}}},methods:{handleCollapse:function(){this.isCollapsed=!this.isCollapsed},showBody:function(){this.isCollapsed&&this.handleCollapse()}}}),he=pe,Ee=Object(g["a"])(he,fe,de,!1,null,null,null),me=Ee.exports,ge=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"flex items-center"},[e.hasGrants?e._l(e.entityGrants,(function(t,r){return n("div",{directives:[{name:"tooltip",rawName:"v-tooltip",value:t,expression:"grant"}],key:r,staticClass:"text-xs h-5 w-4 text-white mr-1 rounded-sm text-center select-none",class:e.grantClass(t),on:{click:function(n){return e.handleGrantClick(t)}}},[e._v(e._s(t.slice(0,1)))])})):[n("div",{staticClass:"w-10 h-1 bg-gray-400 rounded"})]],2)},be=[],Ce=(n("a481"),c["a"].extend({name:"z-entity-grant",props:{type:String,grants:Array,entity:Object,role:String,meta:Object},data:function(){var e;return{allGrants:(e={},Object(i["a"])(e,A.TABLE,["SELECT","INSERT","UPDATE","DELETE","TRUNCATE","REFERENCES","TRIGGER"]),Object(i["a"])(e,A.COLUMN,["SELECT","INSERT","UPDATE","REFERENCES"]),Object(i["a"])(e,A.OBJECT,["USAGE"]),Object(i["a"])(e,A.ROUTINE,["EXECUTE"]),Object(i["a"])(e,A.TRIGGER,[]),e)}},computed:{entityGrants:function(){return this.allGrants[this.type]},hasGrants:function(){return this.entityGrants.length>0}},methods:{hasGrant:function(e){return this.grants.includes(e)},grantClass:function(e){return{"bg-green-400 hover:bg-green-500":this.hasGrant(e),"bg-gray-400 hover:bg-gray-500":!this.hasGrant(e)}},handleGrantClick:function(e){this.hasGrant(e);var t=this.hasGrant(e)?"REVOKE":"GRANT",n=this.hasGrant(e)?"FROM":"TO",r=this.meta.sql.replace("{:action}",t).replace("{:grant}",e).concat(" ".concat(n," ").concat(this.role));this.$emit("run-query",r)}}})),ve=Ce,_e=Object(g["a"])(ve,ge,be,!1,null,null,null),Oe=_e.exports,Te=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"flex rounded items-center mt-1",class:e.wrapClass},[n("div",{staticClass:"w-header__title",class:e.titleStyle},[n("div",{staticClass:"row__head w-100 text-gray-600 bg-gray-300 select-none",class:e.titleFont},[n("fa-icon",{directives:[{name:"tooltip",rawName:"v-tooltip",value:e.type,expression:"type"}],staticClass:"mr-2",attrs:{icon:e.iconFont}}),e._v(e._s(e.title)),e.hasMeta?n("span",{staticClass:"text-xs ml-2 bg-gray-500 text-gray-800 p-1 rounded"},[e._v(e._s(Object.values(e.meta).join(" ")))]):e._e()],1)]),n("div",{staticClass:"row__data flex justify-around p-2 flex-grow text-gray-700 bg-gray-200 rounded-r",class:e.slotClass},[e._t("default")],2)])},ye=[],Se=(n("c5f6"),c["a"].extend({name:"z-manage-row",props:{title:String,type:String,meta:{type:Object,default:void 0},level:{type:Number,default:0},isSticky:{type:Boolean,default:!1}},computed:{hasMeta:function(){return!(this.meta&&"sql"in this.meta)&&void 0!==this.meta},iconFont:function(){var e=new Map([[A.TABLE,"table"],[A.COLUMN,"columns"],[A.ROUTINE,"code"],[A.TRIGGER,"bolt"],[A.OBJECT,"box"],["header","users"]]);return e.get(this.type)},titleStyle:function(){return{"pl-0":0===this.level,"pl-4":1===this.level,"pl-8":2===this.level}},titleFont:function(){return{"text-sm":this.level>0,"bg-gray-400 text-gray-700":0===this.level,"bg-gray-300":1===this.level,"rounded-l":!this.isSticky,"rounded-tl":this.isSticky,"h-10 p-2":0===this.level,"h-8 p-1 pl-2":this.level>0}},slotClass:function(){return{"rounded-r":!this.isSticky,"rounded-tr":this.isSticky,"h-10":0===this.level,"h-8":this.level>0}},wrapClass:function(){return{"border-b-4 border-gray-500":this.isSticky,row__hover:"header"!==this.type}}}})),Ne=Se,we=(n("e665"),Object(g["a"])(Ne,Te,ye,!1,null,null,null)),Re=we.exports,je=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("form",{staticClass:"px-2",on:{submit:function(t){return t.preventDefault(),e.addNewConnection(t)}}},[n("div",{staticClass:"flex justify-between"},[n("z-fieldset",{staticClass:"mr-2 w-1/2",attrs:{label:"User"}},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.connection.user,expression:"connection.user"}],staticClass:"input--basic",attrs:{type:"text",required:""},domProps:{value:e.connection.user},on:{input:function(t){t.target.composing||e.$set(e.connection,"user",t.target.value)}}})]),n("z-fieldset",{staticClass:"w-1/2",attrs:{label:"Password"}},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.connection.password,expression:"connection.password"}],staticClass:"input--basic",attrs:{type:"password",required:""},domProps:{value:e.connection.password},on:{input:function(t){t.target.composing||e.$set(e.connection,"password",t.target.value)}}})])],1),n("div",{staticClass:"flex justify-between"},[n("z-fieldset",{staticClass:"mr-2 w-1/2",attrs:{label:"Host"}},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.connection.host,expression:"connection.host"}],staticClass:"input--basic",attrs:{type:"text",placeholder:"127.0.0.1",required:""},domProps:{value:e.connection.host},on:{input:function(t){t.target.composing||e.$set(e.connection,"host",t.target.value)}}})]),n("z-fieldset",{staticClass:"w-1/2",attrs:{label:"Port"}},[n("input",{directives:[{name:"model",rawName:"v-model.number",value:e.connection.port,expression:"connection.port",modifiers:{number:!0}}],staticClass:"input--basic",attrs:{type:"number",placeholder:"5432",required:""},domProps:{value:e.connection.port},on:{input:function(t){t.target.composing||e.$set(e.connection,"port",e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}})])],1),n("div",{staticClass:"w-full"},[n("z-fieldset",{attrs:{label:"Database"}},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.connection.database,expression:"connection.database"}],staticClass:"input--basic",attrs:{type:"text",required:""},domProps:{value:e.connection.database},on:{input:function(t){t.target.composing||e.$set(e.connection,"database",t.target.value)}}})])],1),e._m(0)])},Ae=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"action__bar mt-2 border-t"},[n("div",{staticClass:"py-2"},[n("button",{staticClass:"button--basic",attrs:{type:"submit"}},[e._v("Add")])])])}],xe=c["a"].extend({name:"z-form-connection",data:function(){return{connection:{user:"",password:"",host:"",port:"",database:""}}},methods:{addNewConnection:function(){this.$store.dispatch(U.NEW_CONNECTION,{connection:this.connection}),this.connection={user:"",password:"",host:"",port:"",database:""}}},components:{ZFieldset:C}}),Ie=xe,Le=Object(g["a"])(Ie,je,Ae,!1,null,null,null),Ge=Le.exports;function Pe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ke(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Pe(n,!0).forEach((function(t){Object(i["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Pe(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Me=c["a"].extend({name:"app",mixins:[w],mounted:function(){var e=this;this.$store.dispatch("init"),this.selectedRoles=this.selected.roles,this.selectedSchemas=this.selected.schemas;window.addEventListener("scroll",(function(t){window.scrollY>337?e.app.showStickyHeader=!0:e.app.showStickyHeader=!1}),{passive:!0})},data:function(){return{selectedRoles:[],selectedSchemas:[],selectedEntities:["Tables","Columns","Objects","Routines","Triggers"],app:{showStickyHeader:!1,showQueryLog:!1,showAddConnection:!1},config:{manage:[{label:"Tables",value:A.TABLE},{label:"Columns",value:A.COLUMN},{label:"Objects",value:A.OBJECT},{label:"Routines",value:A.ROUTINE},{label:"Triggers",value:A.TRIGGER}]},filterCache:[]}},watch:{selectedSchemas:function(e,t){e.length&&this.$store.dispatch(U.GET_INFO,{schemas:e})},selectedRoles:function(e,t){e.length&&this.$store.dispatch(U.GET_GRANTS,{grantees:e})}},computed:ke({},Object(I["c"])(["init","selected"]),{},Object(I["b"])([j.ENTITY_TREE,j.SCHEMA_LIST,j.ROLE_LIST]),{hasSelected:function(){return this.selectedSchemas.length>0&&this.selectedRoles.length>0},headerClass:function(){return{"fixed w-header top-0 mt-1":this.app.showStickyHeader,"w-full":!this.app.showStickyHeader}},filteredEntities:function(){var e=this,t=this.config.manage.filter((function(t){return e.selectedEntities.includes(t.label)})).map((function(e){return e.value}));return this.entityTree.filter((function(e){return t.includes(e.type)}))}}),methods:{runQuery:function(e){this.$store.dispatch(U.RUN_QUERY,{sql:e,schemas:this.selectedSchemas,grantees:this.selectedRoles})}},components:{NavBar:ue,ZCheckbox:S,ZCard:me,ZEntityGrant:Oe,ZManageRow:Re,ZFieldset:C,ZFormConnection:Ge,draggable:u.a}}),Ue=Me,He=(n("034f"),Object(g["a"])(Ue,s,o,!1,null,null,null)),Fe=He.exports,Be=n("bfa9"),De={refreshTable:!1,config:{ignorePg:!0,cache:{hasCached:!1,currentConnection:null,connectionList:null}},selected:{schemas:[],roles:[]},init:{schemas:[],roles:[]},info:{columns:[],roles:[],tables:[],triggers:[],routines:[]},grants:{columns:[],objects:[],routines:[],tables:[]}};c["a"].use(I["a"]);var $e=new Be["a"]({storage:window.localStorage,reducer:function(e){return{config:e.config,selected:e.selected}}}),qe=new I["a"].Store({state:De,mutations:x,actions:ae,getters:ee,plugins:[$e.plugin]}),ze=(n("77ed"),n("def6"),n("fd44"),n("5aea"),n("e37d")),Qe=n("ecee"),Je=n("c074"),Ze=n("b702"),Ye=n("ad3d");Qe["c"].add(Je["f"],Ze["a"],Je["l"],Je["m"],Je["h"],Je["g"],Je["c"],Je["d"],Je["o"],Je["i"],Je["k"],Je["b"],Je["e"],Je["a"],Je["n"],Je["j"]),c["a"].use(ze["a"]),c["a"].component("fa-icon",Ye["a"]),c["a"].config.productionTip=!1,new c["a"]({store:qe,render:function(e){return e(Fe)}}).$mount("#app")},def6:function(e,t,n){},e665:function(e,t,n){"use strict";var r=n("297b"),a=n.n(r);a.a},f7aa:function(e,t,n){"use strict";var r=n("0089"),a=n.n(r);a.a},fd44:function(e,t,n){}});
//# sourceMappingURL=app.83b39bc7.js.map